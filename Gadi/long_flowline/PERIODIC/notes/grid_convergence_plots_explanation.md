# Grid Convergence Analysis Plots Explanation

This document explains the plots generated by the `analyse_grid_convergence.py` script, which performs grid convergence analysis for ice sheet simulations.

## Overview

The script generates a comprehensive 2x2 subplot figure saved as `{profile_id}_{experiment}_convergence_analysis.png` with four distinct visualizations:

## Plot 1: Surface Velocity Comparison (Top Left)

**Location**: `axes[0, 0]` (top-left subplot)  
**Generated at**: `analyse_grid_convergence.py:217`

### Purpose
Compares surface velocity profiles across different grid resolutions to assess how the solution changes with mesh refinement.

### Details
- **X-axis**: Normalized distance (x/L) along the flowline
- **Y-axis**: Surface velocity in m/a (meters per year)
- **Data**: Each line represents a different resolution factor (e.g., 0.75, 0.875, 1.0, 1.125)
- **Visual Elements**: Grid lines with dotted transparency, legend showing resolution factors

### Interpretation
- Overlapping lines indicate good convergence
- Significant differences between resolutions suggest the solution is still mesh-dependent
- The finest resolution (lowest factor) serves as the reference solution

## Plot 2: Basal Velocity Comparison (Top Right)

**Location**: `axes[0, 1]` (top-right subplot)  
**Generated at**: `analyse_grid_convergence.py:218`

### Purpose
Similar to Plot 1 but focuses on basal (bottom) velocity profiles to examine sliding behavior convergence.

### Details
- **X-axis**: Normalized distance (x/L) along the flowline
- **Y-axis**: Basal velocity in m/a (meters per year)
- **Data**: Basal velocity profiles for each resolution factor
- **Visual Elements**: Same styling as surface velocity plot

### Interpretation
- Shows how well the basal sliding solution converges with mesh refinement
- Critical for validating ice dynamics at the ice-bed interface
- Basal velocities are typically smaller than surface velocities

## Plot 3: Convergence Metrics (Bottom Left)

**Location**: `axes[1, 0]` (bottom-left subplot)  
**Generated at**: `analyse_grid_convergence.py:227-231`

### Purpose
Quantifies the convergence behavior by showing error metrics relative to the finest resolution.

### Details
- **X-axis**: Resolution factors (compared to finest resolution)
- **Y-axis**: L2 Relative Error (%) or RMSE (logarithmic scale)
- **Data**: Bar chart showing surface velocity errors for each resolution
- **Reference Line**: Horizontal dashed line at 1% threshold (`self.relative_tolerance`)
- **Error Metrics**: 
  - Relative L2 norm error for normal solutions
  - Absolute RMSE for near-zero solutions (< 0.1 m/a)

### Interpretation
- Bars below the 1% threshold indicate converged solutions
- Decreasing bar heights with finer resolutions show convergence trend
- Logarithmic scale helps visualize small error values

## Plot 4: Computational Scaling (Bottom Right)

**Location**: `axes[1, 1]` (bottom-right subplot)  
**Generated at**: `analyse_grid_convergence.py:234-238`

### Purpose
Illustrates the computational cost associated with different mesh resolutions.

### Details
- **X-axis**: Resolution factor
- **Y-axis**: Mesh vertices (node count)
- **Data**: Line plot with circle markers showing mesh complexity
- **Hardcoded Values**: `{0.75: 51103, 0.875: 43479, 1.0: 43437, 1.125: 44039}`
- **Note Box**: Explains that vertex counts are manually sourced from simulation logs

### Interpretation
- Shows trade-off between solution accuracy and computational cost
- Higher vertex counts generally mean longer simulation times
- Helps identify the optimal balance between accuracy and efficiency

## File Output

The complete figure is saved as a PNG file with:
- **Filename**: `{profile_id:03d}_{experiment}_convergence_analysis.png`
- **Resolution**: 150 DPI
- **Layout**: Tight layout with reserved space for the main title

## Usage Context

These plots are generated as part of a comprehensive grid convergence study that:
1. Loads simulation results from multiple mesh resolutions
2. Calculates quantitative convergence metrics
3. Generates visual comparisons and error analysis
4. Produces both plots and a detailed markdown report

The plots provide both qualitative (visual comparison) and quantitative (error metrics) assessment of whether the numerical solution has achieved grid independence.


# ~~~~~~ INTERPRETATION

    The Effect of Basal Sliding: The most dramatic effect is the introduction of basal slip. The flow in the sliding experiments (S3 and S4) is significantly faster than in their frozen-bed counterparts (S1 and S2). For the linear rheology case, enabling sliding increases the maximum velocity from ~84 m/a (S1) to ~121 m/a (S3).

    The Effect of Ice Rheology (n=1 vs. n=3):

        In the frozen bed condition, the choice of rheology is critical. The non-linear rheology (n=3) makes the ice much stiffer and more resistant to deformation, causing the velocity to drop from ~84 m/a in S1 to a near-static 0.013 m/a in S2.

        In the sliding condition, rheology is still important but basal motion dominates the flow. The non-linear rheology in S4 still results in slower flow (~17 m/a) compared to the linear rheology in S3 (~121 m/a), but the ice continues to move primarily due to slip at the bed.

    Exceptional Convergence in S4: It is particularly noteworthy that experiment S4 (sliding + non-linear rheology), which is the most physically complex and realistic scenario, shows the best convergence, with relative errors rounding to 0.00%. This is an excellent outcome and provides high confidence in the results of your most important simulation.